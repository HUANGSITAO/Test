# 音视频编码基础 #
[http://www.jianshu.com/p/8422b5e14643](http://www.jianshu.com/p/8422b5e14643 "音视频编码基础")</br>
## 视频编码目标 ##
1. 保证压缩比例
2. 保证恢复的质量
3. 易实现，低成本，可靠性

## 压缩的出发点(可行性) ##
1. 时间相关性:在一组视频序列中,相邻两帧只有极少的不同之处
2. 空间相关性:在同一帧中,相邻像素之间有很大的相关性,两像素越近,相关性越强

## 视频编码的原理 ##
**视频编码.md**中有说明

### 场,帧,图像 ###
场:隔行扫描的图像,偶数行成为顶场行.奇数成为底场行.所有顶场行称为顶场,所有低场行称为低场.</br>
帧:逐行扫描的图像</br>
图像:场和帧都可认为是图像 

### 宏块,片 ###
宏块(MB):一个宏块由一个16X16亮度块,一个8X8Cb和一个8X8Cr组成.</br>
片(slice):一个图像可以划分成一个或多个片,一个片由一个或多个宏块组成.

## H264结构和应用 ##
H.264从框架结构上将NAL与VCL分离,主要有两个目的:</br>
其一,可以定义VCL视频压缩处理与NAL网络传输机制的接口,这样允许视频编码层**VCL的设计可以在不同的处理器平台进行移植,而与NAL层的数据封装格式无关.**</br>
其二,VCL和NAL都被设计橙工作与不同的传输环境,异构的网络环境并不需要对VCL比特流进行重构和重编码.

### H264的编码格式 ###
h264的功能分为2层,视频编码层(VCL)和网络提取层(NAL)</br>
VCL公呢个是进行视频编解码,包括运动补偿预测,变换编码和熵编码等功能;</br>
NAL用于采用适当的格式对VCL视频数据进行封装打包

**VCL数据即被压缩编码后的视频数据序列**</br>
在VCL数据要封装到NAL单元中之后,才可以用来传输或存储.</br>
**NAL单元格式**</br>
1字节的头,3个定长的字段和一个字节数不定的编码段组成</br>
头标的语法:NALU类型(5bit),重要性指示位(2bit),禁止位(1bit)</br>
NALU类型:1~12由H.264使用,24~31由H.264以为的应用使用.</br>
重要性指示:标志该NAL单元用于重建时的重要性,值越大,越重要.</br>
禁止位:网络发现NAL单元有比特错误时可设置该比特为1,以便接收方丢掉该单元</br>
1. NAL Units:视频数据封装在整数字节的NALU中,它的第一个字节标志该单元中数据的类型.H.264定义了两种封装格式.基于包交换的网络可以使用RTP封装格式封装NALU.而另外一些系统可能要求就爱那个NALU作为顺序比特流传送,为此H.264定义了一种比特流格式的传输机制,使用start_code_prefix将NALU封装起来,从而确定NAL边界.</br>
2. 参数集:以往视频编解码标准中GOB\GOP\图像等头信息是至关重要的,包含这些信息的包的丢失常导致与这些信息相关的图像不能解码.为此H.264将这些很少变化并且对大量VCL NALU起作用的信息放在参数集中传送.参数集分为两种,即序列参数集和图像参数集.为适应多种网络环境,参数集可以带内传送,也可以采用带外方式传送.</br>
**序列的参数集(SPS):**包括了一个图像序列的所有信息</br>
**图像的参数集(PPS):**包括了一个图像所有片的信息</br>
### H264的网络传输 ###
H.264能够在基于RTP/UDP/IP,H.323/M,MPEG-2传输和H.320协议的网络中使用H.264的RTP封装参考RFC3550,载荷类型(PT)域未作规定.</br>
### 数据的划分 ###
通常情况下,一个宏块的数据是存放在一起而组成片的,数据划分使得一个偏重的宏块数据重新组合,把宏块语义相关的数据组成一个划分,由划分来组装片.在H.264中有三四红不同的数据划分.</br>
1. 头信息的划分:包含片中宏块的类型,量化参数和运动矢量,是片中最重要的信息.</br>
2. 帧内信息划分:包含帧内CBPs和帧内系数,帧内信息可以阻止错误的蔓延.</br>
3. 帧间信息划分:包含帧间CBPs和帧间系数,通常比前两个划分要大得多.</br>